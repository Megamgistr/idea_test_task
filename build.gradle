plugins {
    id 'java-library'
    id "me.champeau.jmh" version "0.6.8"
    id "io.morethan.jmhreport" version "0.9.0"
}

version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    testCompile('org.junit.jupiter:junit-jupiter-params:5.9.0')
    testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.9.0'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.0'
    jmhAnnotationProcessor 'org.openjdk.jmh:jmh-generator-annprocess:1.35'
}

test {
    useJUnitPlatform()
}

jmhReport {
    jmhResultPath = project.file("${project.buildDir}/results/jmh/results.json")
    jmhReportOutput = project.file("${project.buildDir}/results/jmh")
}

jmh {
    fork = 1
    iterations = 5
    warmupIterations = 5
    resultFormat = "JSON"
    benchmarkMode = ['sample']
    profilers = ['gc']
}

task saveData(type: Exec) {
    group = "Execution"
    description = "Push data to storage"
    commandLine "java", "-classpath", sourceSets.main.runtimeClasspath.getAsPath(), 'com.db.PushDataProvider'
}

tasks.jmh.finalizedBy tasks.jmhReport
tasks.jmh.finalizedBy tasks.saveData
